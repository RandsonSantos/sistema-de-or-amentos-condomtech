{% extends 'base.html' %}

{% block title %}O.S. #{{ os.id }}{% endblock %}

{% block content %}
<h2 class="mb-4">Ordem de Serviço #{{ os.id }}</h2>

<div class="mb-3">
  <p><strong>Cliente:</strong> {{ os.cliente.nome }}</p>
  <p><strong>Data:</strong> {{ os.data_criacao.strftime('%d/%m/%Y') }}</p>
  <p><strong>Status:</strong> {{ os.status }}</p>
</div>

<table class="table table-sm table-bordered">
  <thead class="table-light">
    <tr>
      <th>Produto</th>
      <th>Descrição</th>
      <th>Qtd</th>
      <th>Unitário</th>
      <th>Subtotal</th>
    </tr>
  </thead>
  <tbody>
    {% for item in os.itens_os %}
    <tr>
      <td>{{ item.produto.nome }}</td>
      <td>{{ item.produto.descricao }}</td>
      <td>{{ item.quantidade }}</td>
      <td>R$ {{ '%.2f'|format(item.produto.preco) }}</td>
      <td>R$ {{ '%.2f'|format(item.quantidade * item.produto.preco) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="text-end mt-3">
  <p><strong>Subtotal:</strong> R$ {{ '%.2f'|format(subtotal) }}</p>
  <p><strong>Desconto:</strong> R$ {{ '%.2f'|format(os.desconto or 0) }}</p>
  <h5><strong>Total com desconto:</strong> R$ {{ '%.2f'|format(total) }}</strong></h5>
</div>

<div class="mt-4 d-flex gap-2">
  <a href="{{ url_for('gerar_pdf', os_id=os.id) }}" class="btn btn-primary">Gerar PDF</a>
  <a href="{{ url_for('editar_os', os_id=os.id) }}" class="btn btn-warning">Editar</a>
  <a href="{{ url_for('nova_os') }}" class="btn btn-secondary">Nova O.S.</a>
</div>
{% endblock %}
